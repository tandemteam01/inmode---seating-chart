<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>THE INMODE ERA</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
  color: #d4af37;
  text-align: center;
  padding: 60px 20px;
}

.small-title {
  font-size: 14px;
  letter-spacing: 2px;
  color: #bfbfbf;
}

.big-title {
  font-size: 48px;
  font-weight: bold;
  margin: 10px 0 6px;
  text-shadow: 0 0 25px rgba(212,175,55,0.7);
}

.subtitle {
  font-size: 16px;
  margin-bottom: 30px;
  color: #ffffff;
}

.prompt {
  color: white;
  margin-bottom: 15px;
}

.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

input {
  padding: 14px;
  width: 320px;
  max-width: 85vw;
  border: 1px solid #d4af37;
  background: #111;
  color: #fff;
  font-size: 16px;
}

button {
  padding: 14px 24px;
  background: #d4af37;
  border: none;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

button:hover { background: #f1d37a; }

.status {
  margin-top: 14px;
  font-size: 13px;
  opacity: 0.6;
}

.result {
  margin-top: 30px;
  font-size: 26px;
  animation: fadeIn 0.4s ease;
}

.note {
  margin-top: 20px;
  font-size: 16px;
  color: #ffffff;
  opacity: 0.85;
}

/* ซ่อนแผนผังไว้ก่อน */
.map-container {
  margin-top: 45px;
  display: none;
  justify-content: center;
  animation: fadeIn 0.4s ease;
}
.map-container.show { display: flex; }

.map-container img {
  width: 95%;
  max-width: 1100px;
  height: auto;
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<div class="small-title">Welcome to</div>
<div class="big-title">THE INMODE ERA</div>
<div class="subtitle">The Dawn of Innovation</div>

<p class="prompt">Please Enter your Registered name.</p>

<div class="controls">
  <input type="text" id="nameInput" placeholder="Type your name">
  <button onclick="searchSeat()">Search</button>
</div>

<div class="status" id="status">Loading guest list...</div>
<div class="result" id="result"></div>

<div class="map-container" id="mapContainer">
  <img src="seating-map.png" alt="Seating Map">
</div>

<script>
let guests = [];

const sheetID = "1oDF4vOZ2ZgBPbXgIFSQo1jQpa08nP8S9eVw3duDoNJ0";
const sheetName = "guests";
const url = "https://opensheet.elk.sh/" + sheetID + "/" + sheetName;

function normalize(str) {
  return (str || "").toString().trim().toLowerCase();
}

fetch(url)
  .then(res => res.json())
  .then(data => {
    guests = data.map(row => ({
      displayName: (row.name || "").toString().trim(),
      nameNormalized: normalize(row.name),
      table: (row.table || "").toString().trim().toUpperCase(),
      seat: (row.seat || "").toString().trim()
    }));
    document.getElementById("status").innerHTML =
      "Loaded " + guests.length + " guests";
  })
  .catch(error => {
    document.getElementById("status").innerHTML =
      "Unable to load guest list.";
    console.log(error);
  });

function hideMap() {
  document.getElementById("mapContainer").classList.remove("show");
}

function showMap() {
  document.getElementById("mapContainer").classList.add("show");
  document.getElementById("mapContainer").scrollIntoView({ behavior: "smooth", block: "start" });
}

function escapeHtml(str){
  return (str || "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

function searchSeat() {
  let q = normalize(document.getElementById("nameInput").value);
  hideMap();

  let results = guests.filter(g => g.nameNormalized.includes(q));

  if (results.length === 1) {
    const g = results[0];
    const safeName = escapeHtml(g.displayName);

    document.getElementById("result").innerHTML =
      "<div style='font-size:18px; color:white; margin-bottom:6px;'>Welcome, " + safeName + ", to THE INMODE ERA</div>" +
      "<div style='font-size:18px; color:white;'>Please proceed to</div>" +
      "<div style='font-size:44px; margin:10px 0;'>TABLE " + g.table + "</div>" +
      "<div style='font-size:18px; color:white;'>Your seat number is</div>" +
      "<div style='font-size:44px; margin-top:10px;'>" + g.seat + "</div>" +
      "<div class='note'>Please refer to the seating map below to locate your table.</div>";

    showMap();

  } else if (results.length > 1) {
    let list = "<div style='font-size:18px; color:white;'>Multiple results found. Please type your full name.</div><br>";
    results.slice(0, 25).forEach(g => {
      list += escapeHtml(g.displayName) + " — TABLE " + g.table + " SEAT " + g.seat + "<br>";
    });
    document.getElementById("result").innerHTML = list;
  } else {
    document.getElementById("result").innerHTML = "Name not found";
  }
}

document.getElementById("nameInput").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();
    searchSeat();
  }
});

document.getElementById("nameInput").addEventListener("input", function() {
  hideMap();
});
</script>

</body>
</html>
